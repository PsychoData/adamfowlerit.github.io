<form style="margin: 0; padding: 0; display: inline">
  <input class="quickfilter" type="text" placeholder="Quick Filter" />
</form>

<script type="text/javascript">
  function showOnlyMatchedPortals() {
    query = this.value;

    Array.from(document.querySelectorAll("div[class='portal-group'] div[class='portal']")).forEach((portalEntry) => {
      // Remove individual portal entries
      if (query.length >= 2) {
        //searching innerHTML lets us search link text, like 'sspr' for https://aka.ms/sspr
        if (portalEntry.innerHTML.toUpperCase().indexOf(query.toUpperCase()) === -1) {
          //Iterate through all children, even nested children
          Array.from(portalEntry.getElementsByTagName("*")).forEach((elem) => {
            elem.hidden = true
          }
          )
        } else {
          Array.from(portalEntry.getElementsByTagName("*")).forEach((elem) => {
            elem.hidden = false
          })
        };
      } else {
        //Iterate through portal entries un-hiding them in case they were hidden
        Array.from(document.querySelectorAll("div[class='portal-group'] div[class='portal']")).forEach((portalEntry) => {
          Array.from(portalEntry.getElementsByTagName("*")).forEach((elem) => {
            elem.hidden = false
          });
        });
      }
    });
    
    //Iterate through Portal-groups, and check each portal entries underneath and check if all child portal are hidden
    Array.from(document.querySelectorAll("div[class='portal-group']")).forEach((portalGroup) => {
      let num = Array.from(portalGroup.querySelectorAll(".portal *")).reduce(
      //Count how many elements are not-hidden (shown)  
      (total, elem) => total + (elem.hidden === false ? 1 : 0),
        0
      )
      //If all elements are hidden, hide the entire portal-group
      if (num === 0) {
        portalGroup.hidden = true;
      } else {
        //If some portal elements are shown, be certain to show the parent portal-group
        portalGroup.hidden = false;
      }
    });

    // Display message if no portals are found
    totalNum = Array.from(document.querySelectorAll("div[class='portal-group']")).reduce((total, portalGroup) => total + (portalGroup.hidden === false ? 1 : 0), 0)

    if (totalNum === 0) {
      document.getElementsByClassName('nomatches')[0].style = "display: block;"
    } else {
      document.getElementsByClassName('nomatches')[0].style = "display: none;"
    }

  }

  window.onload = function () {
    const qfInput = document.querySelector(".quickfilter");
    qfInput.addEventListener("change", showOnlyMatchedPortals);
    qfInput.addEventListener("keyup", showOnlyMatchedPortals);
  };
</script>
